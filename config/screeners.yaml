restart_interval_minutes: 5  # Интервал перезапуска скринера в минутах (каждые N минут скринер будет перезапускаться)

screeners:
  - name: scr_liquidation_binance  # Имя скринера, который будет использоваться (в данном случае для анализа ликвидаций на Binance)
    enabled: true  # Включен ли этот скринер (true — включен, false — выключен)
    version: "0.1"  # Версия скринера

    params:
      # ---------------------------
      # Базовые фильтры
      # ---------------------------
      intervals: ["15m","1h","4h","1d"]  # Временной интервал для анализа данных (например, 1h / 4h / 1d)
      min_price: 0.0000001  # Минимальная цена для символа (отсечь слишком дешёвые монеты)
      max_price: 1000  # Максимальная цена для символа (отсечь слишком дорогие активы)

      # ✅ Минимальный объем ликвидаций в anchor-свече (если меньше — сигнал игнорируется)
      # BUY: long_liq >= volume_liquid_limit
      # SELL: short_liq >= volume_liquid_limit
      volume_liquid_limit: [15000,20000,30000,50000]

      # ✅ Доминирование ликвидаций (например 5% => 1.05 раза больше противоположных)
      # BUY: long_liq >= short_liq * (1 + liq_dominance_pct/100)
      # SELL: short_liq >= long_liq * (1 + liq_dominance_pct/100)
      liq_dominance_pct: 10.0

      # ==========================================================
      # ✅ RISK / POSITION SIZE (как в Excel)
      # ==========================================================
      # Риск на 1 сделку в % от equity (например 1.0 = 1% от equity)
      risk_trade_pct: 1.0

      # Если задано — используем это значение как equity для расчёта риска (USDT)
      # Если НЕ задано / null — берём equity из таблиц account_state / account_balance_snapshots
      risk_equity_usdt: 1000   # null

      # Какой аккаунт использовать для чтения equity из базы (account_id)
      # Обычно base_main = 1
      risk_account_id: 1

      # ==========================================================
      # ✅ STOP LOSS / TAKE PROFIT (ТОЛЬКО % от цены входа)
      # ==========================================================
      # Стоп в процентах от entry (например 2.0 = 2%)
      stop_loss_pct: 2.0

      # Оставляем только режим pct (другие режимы убраны)
      take_profit_mode: "pct"

      # Тейк в процентах от entry (например 6.0 = 6%)
      take_profit_pct: 6.0

      # ✅ Откуда брать entry-цену (важно!)
      # current       -> текущая цена (ticker_24h.last_price, fallback close)
      # anchor_close  -> close свечи ликвидаций
      # confirm_close -> close свечи подтверждения (самый безопасный)
      entry_price_mode: confirm_close

      # ---------------------------
      # Уровни / Логика
      # ---------------------------
      period_levels: 240  # Количество свечей для поиска уровней поддержки/сопротивления (чем больше — тем стабильнее уровни)

      pivot_left: 4  # Количество свечей слева от текущей свечи для определения пивота (уровня)
      pivot_right: 4  # Количество свечей справа от текущей свечи для определения пивота (уровня)

      level_cluster_tol_pct: 0.003  # Допустимая погрешность кластеризации уровней (0.003 = 0.3%)
      max_level_candidates: 14  # Максимальное количество уровней-кандидатов после кластеризации

      level_tol_pct: 0.005  # Точность касания уровня (±0.5%)

      # ==========================================================
      # ✅ TOUCH / PRE-TOUCH (НОВАЯ ГЛАВНАЯ ЛОГИКА)
      # ==========================================================
      # ✅ Проверяем касание/пересечение уровня ДО крупной ликвидации
      # Смотрим последние N свечей включая anchor: [anchor-2, anchor-1, anchor]
      #
      # BUY  -> только если был TOUCH DOWN (нижний уровень)
      # SELL -> только если был TOUCH UP (верхний уровень)
      touch_lookback_candles: 3
      touch_mode: "touch_or_cross"   # или "touch" / "cross"

      # ==========================================================
      # ✅ CONFIRMATION (подтверждение направления)
      # ==========================================================
      confirm_lookforward: 3  # Количество свечей после anchor, где ищем подтверждение

      # ✅ Подтверждение направления делается по ЗАКРЫТЫМ свечам:
      # BUY  -> ищем хотя бы 1 зелёную свечу (close > open)
      # SELL -> ищем хотя бы 1 красную свечу (close < open)

      # ---------------------------
      # ✅ Фильтр "аномального объёма свечи" (vol_ratio)
      # ---------------------------
      windows: 20  # Окно средней нормы объёма до anchor
      kof_Volume: 3.0  # volume_anchor / avg_volume >= kof_Volume  (если не нужен фильтр — ставь 0)

      # ---------------------------
      # Опциональные подтверждения (можно выключить полностью)
      # ---------------------------
      kof_fund: 0.0001  # Коэффициент для фильтра финансирования (используется если enable_funding=true)
      enable_funding: true  # Включить ли проверку funding-rate
      enable_oi: false  # Включить ли проверку open_interest
      enable_cvd: false  # Включить ли проверку CVD (Cumulative Volume Delta)

      # ---------------------------
      # ✅ Графики (можно отключить)
      # ---------------------------
      enable_plots: true  # Включить ли сохранение графиков сигналов
      plots_dir: "artifacts/screener_plots"  # Папка для графиков
      plot_lookback: 120  # Количество свечей назад для отображения на графике
      plot_lookforward: 40  # Количество свечей вперед для отображения на графике

      # ---------------------------
      # Дебаг
      # ---------------------------
      debug: true  # Включить подробные логи почему символ не прошёл фильтр
      debug_top: 3  # Количество топ строк в debug (по сумме liq_long+liq_short)

      # ✅ TELEGRAM
      telegram_enabled: true
      telegram_timezone: "Europe/Moscow"   # можно удалить => возьмёт локальную ОС

      # ✅ Внешние получатели
      telegram_extras_enabled: true
      telegram_max_friends: 2

      # ❌ отдельные текстовые сообщения НЕ шлём
      telegram_send_text: false

      # ✅ шлём график + caption (одно сообщение)
      telegram_send_plots: true
      telegram_plot_mode: "photo"
      telegram_max_plot_signals: 50

      # ❌ если в коде включали "второе сообщение после фото" — выключаем
      telegram_send_plot_followup_text: false

      # (опционально) ограничить генерацию графиков
      plot_max_signals: 50



